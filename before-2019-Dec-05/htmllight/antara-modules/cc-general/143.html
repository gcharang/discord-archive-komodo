<!DOCTYPE html>
<html lang="en">

<head>
    <title>Komodo - cc-general</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />

    <style>
        /* === GENERAL === */

@font-face {
    font-family: Whitney;
    src: url(https://discordapp.com/assets/6c6374bad0b0b6d204d8d6dc4a18d820.woff);
    font-weight: 300;
}

@font-face {
    font-family: Whitney;
    src: url(https://discordapp.com/assets/e8acd7d9bf6207f99350ca9f9e23b168.woff);
    font-weight: 400;
}

@font-face {
    font-family: Whitney;
    src: url(https://discordapp.com/assets/3bdef1251a424500c1b3a78dea9b7e57.woff);
    font-weight: 500;
}

@font-face {
    font-family: Whitney;
    src: url(https://discordapp.com/assets/be0060dafb7a0e31d2a1ca17c0708636.woff);
    font-weight: 600;
}

@font-face {
    font-family: Whitney;
    src: url(https://discordapp.com/assets/8e12fb4f14d9c4592eb8ec9f22337b04.woff);
    font-weight: 700;
}

body {
    font-family: "Whitney", "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 17px;
}

a {
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

img {
    object-fit: contain;
}

.markdown {
    white-space: pre-wrap;
    line-height: 1.3;
    overflow-wrap: break-word;
}

.spoiler {
    border-radius: 3px;
}

.quote {
    border-left: 4px solid;
    border-radius: 3px;
    margin: 8px 0;
    padding-left: 10px;
}

.pre {
    font-family: "Consolas", "Courier New", Courier, monospace;
}

.pre--multiline {
    margin-top: 4px;
    padding: 8px;
    border: 2px solid;
    border-radius: 5px;
}

.pre--inline {
    padding: 2px;
    border-radius: 3px;
    font-size: 85%;
}

.mention {
    font-weight: 500;
}

.emoji {
    width: 1.45em;
    height: 1.45em;
    margin: 0 1px;
    vertical-align: -0.4em;
}

.emoji--small {
    width: 1rem;
    height: 1rem;
}

.emoji--large {
    width: 2rem;
    height: 2rem;
}

/* === INFO === */

.info {
    display: flex;
    max-width: 100%;
    margin: 0 5px 10px 5px;
}

.info__guild-icon-container {
    flex: 0;
}

.info__guild-icon {
    max-width: 88px;
    max-height: 88px;
}

.info__metadata {
    flex: 1;
    margin-left: 10px;
}

.info__guild-name {
    font-size: 1.4em;
}

.info__channel-name {
    font-size: 1.2em;
}

.info__channel-topic {
    margin-top: 2px;
}

.info__channel-message-count {
    margin-top: 2px;
}

.info__channel-date-range {
    margin-top: 2px;
}

/* === CHATLOG === */

.chatlog {
    max-width: 100%;
    margin-bottom: 24px;
}

.chatlog__message-group {
    display: flex;
    margin: 0 10px;
    padding: 15px 0;
    border-top: 1px solid;
}

.chatlog__author-avatar-container {
    flex: 0;
    width: 40px;
    height: 40px;
}

.chatlog__author-avatar {
    border-radius: 50%;
    height: 40px;
    width: 40px;
}

.chatlog__messages {
    flex: 1;
    min-width: 50%;
    margin-left: 20px;
}

.chatlog__author-name {
    font-size: 1em;
    font-weight: 500;
}

.chatlog__timestamp {
    margin-left: 5px;
    font-size: .75em;
}

.chatlog__message {
    padding: 2px 5px;
    margin-right: -5px;
    margin-left: -5px;
    background-color: transparent;
    transition: background-color 1s ease;
}

.chatlog__content {
    font-size: .9375em;
    word-wrap: break-word;
}

.chatlog__edited-timestamp {
    margin-left: 3px;
    font-size: .8em;
}

.chatlog__attachment-thumbnail {
    margin-top: 5px;
    max-width: 50%;
    max-height: 500px;
    border-radius: 3px;
}

.chatlog__embed {
    margin-top: 5px;
    display: flex;
    max-width: 520px;
}

.chatlog__embed-color-pill {
    flex-shrink: 0;
    width: 4px;
    border-top-left-radius: 3px;
    border-bottom-left-radius: 3px;
}

.chatlog__embed-content-container {
    display: flex;
    flex-direction: column;
    padding: 8px 10px;
    border: 1px solid;
    border-top-right-radius: 3px;
    border-bottom-right-radius: 3px;
}

.chatlog__embed-content {
    width: 100%;
    display: flex;
}

.chatlog__embed-text {
    flex: 1;
}

.chatlog__embed-author {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
}

.chatlog__embed-author-icon {
    width: 20px;
    height: 20px;
    margin-right: 9px;
    border-radius: 50%;
}

.chatlog__embed-author-name {
    font-size: .875em;
    font-weight: 600;
}

.chatlog__embed-title {
    margin-bottom: 4px;
    font-size: .875em;
    font-weight: 600;
}

.chatlog__embed-description {
    font-weight: 500;
    font-size: 14px;
}

.chatlog__embed-fields {
    display: flex;
    flex-wrap: wrap;
}

.chatlog__embed-field {
    flex: 0;
    min-width: 100%;
    max-width: 506px;
    padding-top: 10px;
}

.chatlog__embed-field--inline {
    flex: 1;
    flex-basis: auto;
    min-width: 150px;
}

.chatlog__embed-field-name {
    margin-bottom: 4px;
    font-size: .875em;
    font-weight: 600;
}

.chatlog__embed-field-value {
    font-size: .875em;
    font-weight: 500;
}

.chatlog__embed-thumbnail {
    flex: 0;
    margin-left: 20px;
    max-width: 80px;
    max-height: 80px;
    border-radius: 3px;
}

.chatlog__embed-image-container {
    margin-top: 10px;
}

.chatlog__embed-image {
    max-width: 500px;
    max-height: 400px;
    border-radius: 3px;
}

.chatlog__embed-footer {
    margin-top: 10px;
}

.chatlog__embed-footer-icon {
    margin-right: 4px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    vertical-align: middle;
}

.chatlog__embed-footer-text {
    font-weight: 500;
    font-size: .75em;
}

.chatlog__reactions {
    display: flex;
}

.chatlog__reaction {
    display: flex;
    align-items: center;
    margin: 6px 2px 2px 2px;
    padding: 3px 6px;
    border-radius: 3px;
}

.chatlog__reaction-count {
    min-width: 9px;
    margin-left: 6px;
    font-size: .875em;
}

.chatlog__bot-tag {
    margin-left: 0.3em;
    background: #7289da;
    color: #ffffff;
    font-size: 0.625em;
    padding: 1px 2px;
    border-radius: 3px;
    vertical-align: middle;
    line-height: 1.3;
    position: relative;
    top: -.2em;
}
    </style>
    <style>
        /* === GENERAL === */

body {
    background-color: #ffffff;
    color: #23262a;
    font-weight: 500;
}

a {
    color: #00b0f4;
}

.spoiler {
    background-color: rgba(0, 0, 0, 0.1);
}

.quote {
    border-color: #c7ccd1;
}

.pre {
    background-color: #f9f9f9 !important;
}

.pre--multiline {
    border-color: #f3f3f3 !important;
    color: #657b83 !important;
}

.mention {
    background-color: #f1f3fb;
    color: #7289da;
}

/* === INFO === */

.info__guild-name {
    color: #2f3136;
}

.info__channel-name {
    color: #2f3136;
}

.info__channel-topic {
    color: #2f3136;
}

/* === CHATLOG === */

.chatlog__message-group {
    border-color: #eceeef;
}

.chatlog__author-name {
    font-weight: 600;
    color: #2f3136;
}

.chatlog__timestamp {
    color: #747f8d;
}

.chatlog__message--highlighted {
    background-color: rgba(114, 137, 218, 0.2) !important;
}

.chatlog__message--pinned {
    background-color: rgba(249, 168, 37, 0.05);
}

.chatlog__edited-timestamp {
    color: #747f8d;
}

.chatlog__embed-content-container {
    background-color: rgba(249, 249, 249, 0.3);
    border-color: rgba(204, 204, 204, 0.3);
}

.chatlog__embed-author-name {
    color: #4f545c;
}

.chatlog__embed-author-name-link {
    color: #4f545c;
}

.chatlog__embed-title {
    color: #4f545c;
}

.chatlog__embed-description {
    color: #737f8d;
}

.chatlog__embed-field-name {
    color: #36393e;
}

.chatlog__embed-field-value {
    color: #737f8d;
}

.chatlog__embed-footer {
    color: rgba(79, 83, 91, 0.6);
}

.chatlog__reaction {
    background-color: rgba(79, 84, 92, 0.06);
}

.chatlog__reaction-count {
    color: #747f8d;
}
    </style>

    <script>
        function scrollToMessage(event, id) {
            var element = document.getElementById('message-' + id);

            if (element !== null && element !== undefined) {
                event.preventDefault();

                element.classList.add('chatlog__message--highlighted');

                window.scrollTo({
                    top: element.getBoundingClientRect().top - document.body.getBoundingClientRect().top - (window.innerHeight / 2),
                    behavior: 'smooth'
                });

                window.setTimeout(function() {
                    element.classList.remove('chatlog__message--highlighted');
                }, 2000);
            }
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/solarized-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.pre--multiline').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    </script>
</head>
<body>

<div class="info">
    <div class="info__guild-icon-container">
        <img class="info__guild-icon" src="https://cdn.discordapp.com/icons/412898016371015680/a_157cb08c4198ad53b9e9b7168c930571.png" />
    </div>
    <div class="info__metadata">
        <div class="info__guild-name">Komodo</div>
        <div class="info__channel-name">cc-general</div>

            <div class="info__channel-topic">Dev Docs: https://developers.komodoplatform.com | Test plan: https://docs.google.com/spreadsheets/d/1l0dWEPcrv9zE11_TD-XrX_HIYV0VLpadCJN6hvaZERc/edit#gid=211514340
https://medium.com/@jameslee777/how-to-implement-finite-state-machines-into-a-cc-8dfeadccbcad
https://github.com/dimxy/komodo/wiki/Designing-RPC-for-FSM-CC</div>

        <div class="info__channel-message-count">100 messages</div>

            <div class="info__channel-date-range">
                    Before 05-Dec-19 12:00 AM
            </div>
    </div>
</div>

<div class="chatlog">
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:13 PM</span>

                    <div class="chatlog__message " data-message-id="520211200735444992" id="message-520211200735444992">
                        <div class="chatlog__content">
                            <span class="markdown">i actually never checked the value of consensusBranchId</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:14 PM</span>

                    <div class="chatlog__message " data-message-id="520211378972131339" id="message-520211378972131339">
                        <div class="chatlog__content">
                            <span class="markdown">sighash and msgHash from cc_verify?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:15 PM</span>

                    <div class="chatlog__message " data-message-id="520211570656149524" id="message-520211570656149524">
                        <div class="chatlog__content">
                            <span class="markdown">rc = secp256k1_ecdsa_verify(ec_ctx_verify, &amp;sig, visitor.msg, &amp;pk);
visitor.msg and sighash</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520211616218742787" id="message-520211616218742787">
                        <div class="chatlog__content">
                            <span class="markdown">they should be the same, assuming the same keypair is used</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:15 PM</span>

                    <div class="chatlog__message " data-message-id="520211641590218762" id="message-520211641590218762">
                        <div class="chatlog__content">
                            <span class="markdown">Yep, ok.</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:15 PM</span>

                    <div class="chatlog__message " data-message-id="520211695147417601" id="message-520211695147417601">
                        <div class="chatlog__content">
                            <span class="markdown">so verify the matching pubkey is used for the privkey that signed it</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520211722859053066" id="message-520211722859053066">
                        <div class="chatlog__content">
                            <span class="markdown">that is the only way that should fail</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520211794716000256" id="message-520211794716000256">
                        <div class="chatlog__content">
                            <span class="markdown">signing with the mismatched privkey, or singing the wrong hash</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:21 PM</span>

                    <div class="chatlog__message " data-message-id="520213192526266379" id="message-520213192526266379">
                        <div class="chatlog__content">
                            <span class="markdown">This is the print from FinalizeCCtx:
<div class="pre pre--multiline nohighlight">consensus 1991772603
72d8a144331d923e1eba11f5c74867be3512bf0942ee8f4951ea81b1595b7b2b
consensus 1991772603
f88cdd8b6ecf9a2ecc5ab4519333a4a7938d391db62c23665339c04029f25c06</div>
Those are two sighash for vin0 and vin1 I think

And this is msg32 from visitor when it does cc_verify for vin1:
<div class="pre pre--multiline nohighlight">D3F3BE70754A39BA254F5167A56761648D4CF32E4B29DC72A000077D660C5AF6</div></span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:22 PM</span>

                    <div class="chatlog__message " data-message-id="520213567912542208" id="message-520213567912542208">
                        <div class="chatlog__content">
                            <span class="markdown">aha! that is why it fails</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520213679036301339" id="message-520213679036301339">
                        <div class="chatlog__content">
                            <span class="markdown">so the question is why is visitor.msg D3F3BE70754A39BA254F5167A56761648D4CF32E4B29DC72A000077D660C5AF6 instead of f88cdd8b6ecf9a2ecc5ab4519333a4a7938d391db62c23665339c04029f25c06</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520213828722622474" id="message-520213828722622474">
                        <div class="chatlog__content">
                            <span class="markdown">so at least we found the exact cause and hopefully can find that the visitor.msg is using a different way to get sighash</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520213865263398912" id="message-520213865263398912">
                        <div class="chatlog__content">
                            <span class="markdown">or the sighash function is called with slightly different parameters</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:25 PM</span>

                    <div class="chatlog__message " data-message-id="520214165286158352" id="message-520214165286158352">
                        <div class="chatlog__content">
                            <span class="markdown">I do not think this is correct compare, as I started new oracle and tested when oraclesdata works and they are still different</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520214321004019713" id="message-520214321004019713">
                        <div class="chatlog__content">
                            <span class="markdown"><div class="pre pre--multiline nohighlight">consensus 1991772603
3a03adb18ad8261873e77df3e87e5f0d27fca85fa9120600abdae9d13e7bf81f
consensus 1991772603
0c6202fcbdbaf1ab36bfdc7b50184e80baf55c5d82d3a85921337126f5500678</div>
<div class="pre pre--multiline nohighlight">1FF87B3ED1E9DAAB000612A95FA8FC270D5F7EE8F37DE7731826D88AB1AD033A
780650F52671332159A8D3825D5CF5BA804E18507BDCBF36ABF1BABDFC02620C</div></span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:32 PM</span>

                    <div class="chatlog__message " data-message-id="520215896346722324" id="message-520215896346722324">
                        <div class="chatlog__content">
                            <span class="markdown">it seems rc = secp256k1_ecdsa_verify(ec_ctx_verify, &amp;sig, visitor.msg, &amp;pk);
is verifying it, but the CC signing is a bit more complex and it seems to call cc_visit which automatically add a signature?</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520215998754979841" id="message-520215998754979841">
                        <div class="chatlog__content">
                            <span class="markdown">you need to dig into the crytoconditions code to see what exactly it is signing with the secp256k1 sign function</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520216143194095626" id="message-520216143194095626">
                        <div class="chatlog__content">
                            <span class="markdown">it could be that the sighash in finalizeCCtx is being processed. I know the CC vout is a hash of the actual condition</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520216197514395649" id="message-520216197514395649">
                        <div class="chatlog__content">
                            <span class="markdown">so there is another layer of processing going on</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:33 PM</span>

                    <div class="chatlog__message " data-message-id="520216216544215051" id="message-520216216544215051">
                        <div class="chatlog__content">
                            <span class="markdown">Ok, need to get to know how it all works. BTW, who wrote the core of CC?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:33 PM</span>

                    <div class="chatlog__message " data-message-id="520216240820846603" id="message-520216240820846603">
                        <div class="chatlog__content">
                            <span class="markdown">libscott</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520216297141829652" id="message-520216297141829652">
                        <div class="chatlog__content">
                            <span class="markdown">let me know when you find the exact values being secp256k1 signed</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520216324337565699" id="message-520216324337565699">
                        <div class="chatlog__content">
                            <span class="markdown">we need to get 100% up to speed with this code</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:34 PM</span>

                    <div class="chatlog__message " data-message-id="520216364586369024" id="message-520216364586369024">
                        <div class="chatlog__content">
                            <span class="markdown">Ok, and is he around if I need some help?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:37 PM</span>

                    <div class="chatlog__message " data-message-id="520217324666486784" id="message-520217324666486784">
                        <div class="chatlog__content">
                            <span class="markdown">he is around occasionally, but the code is there, so I think we can solve this one</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:48 PM</span>

                    <div class="chatlog__message " data-message-id="520220086649356298" id="message-520220086649356298">
                        <div class="chatlog__content">
                            <span class="markdown">Ok, so it is a problem that visitor msg is different after all:
<div class="pre pre--multiline nohighlight">01689a936c74cf0de5681df6d3231167edf152850d855a9f4f78a2fb2d6d9922 sighash, 7329453ccd1035fb04f658c0d67478ca60d82a98c54bdc4c0e7d36c8c9e73297 signed with privkey
faaf33dd9ed46ff577a6b9f83f40606fa4a5bc7e76ffdc7907cab9b0e02edd7f sighash, 84621e9eb74ea9218d47937930e854bae5eff798bf2c23306c66d433cd68b728 signed with privkey

01689a936c74cf0de5681df6d3231167edf152850d855a9f4f78a2fb2d6d9922
faaf33dd9ed46ff577a6b9f83f40606fa4a5bc7e76ffdc7907cab9b0e02edd7f

b909cd5fa57c7c781a341673531866ae1c0eaada34d28234f8c72fb03d96273e sighash, 7329453ccd1035fb04f658c0d67478ca60d82a98c54bdc4c0e7d36c8c9e73297 signed with privkey
42ed6b230b24f1aad716aee9322f1d23a3733499c765c5fb975426cb3e41cb60 sighash, 84621e9eb74ea9218d47937930e854bae5eff798bf2c23306c66d433cd68b728 signed with privkey

f82fa488427d261e1f82038fe8eca6c7843ac7880f0ef45aeac6dc71f5bfc50e
cc_verify error C
ERROR: CScriptCheck(): bd217b74b48be1c6c23de7e0d1bbadf53562da61a5a9f31c43cae5cabe90858d:1 VerifySignature failed: Script evaluated without error but finished with a false/empty top stack element
f82fa488427d261e1f82038fe8eca6c7843ac7880f0ef45aeac6dc71f5bfc50e
cc_verify error C
ERROR: CScriptCheck(): bd217b74b48be1c6c23de7e0d1bbadf53562da61a5a9f31c43cae5cabe90858d:1 VerifySignature failed: Script evaluated without error but finished with a false/empty top stack element</div></span>

                                <span class="chatlog__edited-timestamp" title="06-Dec-18 12:49 PM">(edited)</span>
                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520220307320209408" id="message-520220307320209408">
                        <div class="chatlog__content">
                            <span class="markdown">So the first check matches 016... and faa..., but the second is different and this is when oraclesdata fails.</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:51 PM</span>

                    <div class="chatlog__message " data-message-id="520220657334878208" id="message-520220657334878208">
                        <div class="chatlog__content">
                            <span class="markdown">good, now to find out the difference in how it is called.</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520220892534407178" id="message-520220892534407178">
                        <div class="chatlog__content">
                            <span class="markdown">i might know why! when it is validating the mempool, it sometimes doesnt know the current height and maybe it defaults to the wrong height</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221058415067136" id="message-520221058415067136">
                        <div class="chatlog__content">
                            <span class="markdown">in CCutils.cpp ProcessCC:
    height = KOMODO_CONNECTING;
    if ( KOMODO_CONNECTING &lt; 0 ) // always comes back with &gt; 0 for final confirmation
        return(true);
    if ( ASSETCHAINS_CC == 0 || (height &amp; ~(1&lt;&lt;30)) &lt; KOMODO_CCACTIVATE )
        return eval-&gt;Invalid(&quot;CC are disabled or not active yet&quot;);
    if ( (KOMODO_CONNECTING &amp; (1&lt;&lt;30)) != 0 )
    {
        from_mempool = 1;
        height &amp;= ((1&lt;&lt;30) - 1);
    }</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221204389298191" id="message-520221204389298191">
                        <div class="chatlog__content">
                            <span class="markdown">KOMODO_CONNECTING I try to set sanely in all paths coming in from main.cpp, but it can get called from ProcessBlock, which is async from network traffics</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221359561900032" id="message-520221359561900032">
                        <div class="chatlog__content">
                            <span class="markdown">and if the different height is used, it would think it is a different consensusBranchId</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221423898198027" id="message-520221423898198027">
                        <div class="chatlog__content">
                            <span class="markdown">One solution for this is that where it errors to try the alternate serialization</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221495952146432" id="message-520221495952146432">
                        <div class="chatlog__content">
                            <span class="markdown">so if it is sapling active and it fails, try the sapling inactive serialization</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:54 PM</span>

                    <div class="chatlog__message " data-message-id="520221527271014400" id="message-520221527271014400">
                        <div class="chatlog__content">
                            <span class="markdown">I saw when I&#39;ve done prints from cc_verify that sometimes it overlaps so it is multithreaded, could it be some synchronization problem?</span>

                                <span class="chatlog__edited-timestamp" title="06-Dec-18 12:55 PM">(edited)</span>
                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:54 PM</span>

                    <div class="chatlog__message " data-message-id="520221544648015885" id="message-520221544648015885">
                        <div class="chatlog__content">
                            <span class="markdown">if sapling inactive fails, try sapling active</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221578647175171" id="message-520221578647175171">
                        <div class="chatlog__content">
                            <span class="markdown">it is multithreaded</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221640421015552" id="message-520221640421015552">
                        <div class="chatlog__content">
                            <span class="markdown">ProcessBlock happens while connectblock is happening, this is all the time</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221688630345728" id="message-520221688630345728">
                        <div class="chatlog__content">
                            <span class="markdown">I think this is the other explanation for intermittent</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221757077061642" id="message-520221757077061642">
                        <div class="chatlog__content">
                            <span class="markdown">it depends on the mempool and when a tx is coming in to be verified in the middle of another</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221864916680714" id="message-520221864916680714">
                        <div class="chatlog__content">
                            <span class="markdown">so when there are both sapling active and inactive on the network, it can end up using the wrong serialization format to calculate the sighash</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221928741404672" id="message-520221928741404672">
                        <div class="chatlog__content">
                            <span class="markdown">so the fix is to use both serializations in the validation</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520221982206197765" id="message-520221982206197765">
                        <div class="chatlog__content">
                            <span class="markdown">i hope you can understand what I am saying</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:57 PM</span>

                    <div class="chatlog__message " data-message-id="520222219587289115" id="message-520222219587289115">
                        <div class="chatlog__content">
                            <span class="markdown">Well not fully,. as I had no time by now to even check what sapling does <img class="emoji " alt="ðŸ˜³" title="ðŸ˜³" src="https://twemoji.maxcdn.com/2/72x72/1f633.png" /></span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:57 PM</span>

                    <div class="chatlog__message " data-message-id="520222335618514944" id="message-520222335618514944">
                        <div class="chatlog__content">
                            <span class="markdown">sapling changes the tx serialization which would change the sighash</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520222367121670144" id="message-520222367121670144">
                        <div class="chatlog__content">
                            <span class="markdown">that is all that matters here</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520222410205691915" id="message-520222410205691915">
                        <div class="chatlog__content">
                            <span class="markdown">and the height of the tx determines if it is sapling or not</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520222490447052807" id="message-520222490447052807">
                        <div class="chatlog__content">
                            <span class="markdown">and there is the normal block processing and network based async processing</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:58 PM</span>

                    <div class="chatlog__message " data-message-id="520222536877998110" id="message-520222536877998110">
                        <div class="chatlog__content">
                            <span class="markdown">Sapling starts from some height and then it always use sapling?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:58 PM</span>

                    <div class="chatlog__message " data-message-id="520222558801362944" id="message-520222558801362944">
                        <div class="chatlog__content">
                            <span class="markdown">both sharing the same global to set the current height of the CC</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520222644516290560" id="message-520222644516290560">
                        <div class="chatlog__content">
                            <span class="markdown">yes, once sapling is active it stays active, but tx from older heights can still be process and must be valid</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520222694378176517" id="message-520222694378176517">
                        <div class="chatlog__content">
                            <span class="markdown">but the cross talk will reduce a lot the longer we are in all sapling</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520222722597453824" id="message-520222722597453824">
                        <div class="chatlog__content">
                            <span class="markdown">so the cost of an extra validate on error is ok</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 12:59 PM</span>

                    <div class="chatlog__message " data-message-id="520222760530608148" id="message-520222760530608148">
                        <div class="chatlog__content">
                            <span class="markdown">Ok, but on my chain sapling started at height 61 and everything I&#39;ve done was way after that height.</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 12:59 PM</span>

                    <div class="chatlog__message " data-message-id="520222825366421504" id="message-520222825366421504">
                        <div class="chatlog__content">
                            <span class="markdown">in some cases the global height is set to 0</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520222845159211028" id="message-520222845159211028">
                        <div class="chatlog__content">
                            <span class="markdown">which is &lt;61</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 01:00 PM</span>

                    <div class="chatlog__message " data-message-id="520223021714112513" id="message-520223021714112513">
                        <div class="chatlog__content">
                            <span class="markdown">Oh, you mean sometimes when it validates tx it doesn&#39;t know which height it is so it uses 0 and then it will user different serialization?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 01:00 PM</span>

                    <div class="chatlog__message " data-message-id="520223054052458496" id="message-520223054052458496">
                        <div class="chatlog__content">
                            <span class="markdown">yes</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 01:00 PM</span>

                    <div class="chatlog__message " data-message-id="520223070796120074" id="message-520223070796120074">
                        <div class="chatlog__content">
                            <span class="markdown">Got it!</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 01:00 PM</span>

                    <div class="chatlog__message " data-message-id="520223088911319041" id="message-520223088911319041">
                        <div class="chatlog__content">
                            <span class="markdown">pretty certain that is what is going on</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520223187724795914" id="message-520223187724795914">
                        <div class="chatlog__content">
                            <span class="markdown">it was a flimsy thing, but alternative was to flow through height all the way from main.cpp deep into CC validation</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520223341441843210" id="message-520223341441843210">
                        <div class="chatlog__content">
                            <span class="markdown">that is the alternative way to fix this, to remove KOMODO_CONNECTING and pass in an always accurate height into ProcessCC</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520223376699293696" id="message-520223376699293696">
                        <div class="chatlog__content">
                            <span class="markdown">which comes in from tx validation</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520223394814492741" id="message-520223394814492741">
                        <div class="chatlog__content">
                            <span class="markdown">and script interpreter</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520223453240885249" id="message-520223453240885249">
                        <div class="chatlog__content">
                            <span class="markdown">it was a C++ minefield for me so I decided to use global</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520223526117048321" id="message-520223526117048321">
                        <div class="chatlog__content">
                            <span class="markdown">maybe you can make a clean way</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520223599085355018" id="message-520223599085355018">
                        <div class="chatlog__content">
                            <span class="markdown">maybe adding txheight field to the tx being validated that will be there when ProcessCC is called</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 01:03 PM</span>

                    <div class="chatlog__message " data-message-id="520223755083972618" id="message-520223755083972618">
                        <div class="chatlog__content">
                            <span class="markdown">Ok, I&#39;m going for lunch and will try it on when I&#39;m back.</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 02:36 PM</span>

                    <div class="chatlog__message " data-message-id="520247104464093186" id="message-520247104464093186">
                        <div class="chatlog__content">
                            <span class="markdown"><span class="mention" title="jl777c#5810">@jl777c</span> I don&#39;t quite see how KOMODO_CONNECTING has influence which serialization will be used ...</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 02:37 PM</span>

                    <div class="chatlog__message " data-message-id="520247292754788412" id="message-520247292754788412">
                        <div class="chatlog__content">
                            <span class="markdown">for now lets just try the alternate serialization if the selected one gets an error</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520247373621100544" id="message-520247373621100544">
                        <div class="chatlog__content">
                            <span class="markdown">the other way would be way too much code changes this close to an update</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520247515090649088" id="message-520247515090649088">
                        <div class="chatlog__content">
                            <span class="markdown">just need to know how the visitor.msg was calculated and how to do the alternate calc if it gets an error</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 02:55 PM</span>

                    <div class="chatlog__message " data-message-id="520252059031699467" id="message-520252059031699467">
                        <div class="chatlog__content">
                            <span class="markdown">This is what differs when calculating sighash in CCTx and in verify:
<div class="pre pre--multiline language-cpp">printf(&quot;txdata: %s %s %s %s\n&quot;,txdata.hashOutputs.GetHex().data(),txdata.hashPrevouts.GetHex().data(),txdata.hashSequence.GetHex().data(),txdata.hashJoinSplits.GetHex().data());</div>
<div class="pre pre--multiline nohighlight">txdata: 93a6e371082be9f172b5803f44ec6ae08d5a7d4dbddd1732b6b46667e83e4a6c 47cce7339ce18a01f0a92b5581c2e8fb83c4d3751af525a760802286952cd210 5c4cf0d63b1e79c0cb592656fdc1873d22c6f594f34924a4c7fa32fdb8b15d89 950ffd3ef48936edb04059e67bf7c45aca8450e020243754e9c80e7965b1f33b

txdata: 93a6e371082be9f172b5803f44ec6ae08d5a7d4dbddd1732b6b46667e83e4a6c 1751fa8a98662f7e09f8dee3d8bc748bfdbf95687a810ad5f4771240529d7650 5c4cf0d63b1e79c0cb592656fdc1873d22c6f594f34924a4c7fa32fdb8b15d89 950ffd3ef48936edb04059e67bf7c45aca8450e020243754e9c80e7965b1f33b</div>
The second variable is txdata.hashPrevouts which is different <img class="emoji " alt="ðŸ˜®" title="ðŸ˜®" src="https://twemoji.maxcdn.com/2/72x72/1f62e.png" /></span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520252700315877386" id="message-520252700315877386">
                        <div class="chatlog__content">
                            <span class="markdown">Verification takes txdata from TransactionSignatureChecker class: <span class="pre pre--inline">sighash = SignatureHash(CCPubKey(cond), *txTo, nIn, nHashType, amount, consensusBranchId, this-&gt;txdata);</span>
And CCTx gets it from mtx passed.</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:01 PM</span>

                    <div class="chatlog__message " data-message-id="520253433559908352" id="message-520253433559908352">
                        <div class="chatlog__content">
                            <span class="markdown">something is overwriting vin[1] ??</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520253530515439626" id="message-520253530515439626">
                        <div class="chatlog__content">
                            <span class="markdown">that woudl indeed change the sighash</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520253612597706774" id="message-520253612597706774">
                        <div class="chatlog__content">
                            <span class="markdown">do we know if it is the same tx being validated in the working vs not working case?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:02 PM</span>

                    <div class="chatlog__message " data-message-id="520253626455687168" id="message-520253626455687168">
                        <div class="chatlog__content">
                            <span class="markdown">Don&#39;t know. It should not. I&#39;m trying to figure out where it got this data and how it can be different</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520253749676081153" id="message-520253749676081153">
                        <div class="chatlog__content">
                            <span class="markdown">&quot;do we know if it is the same tx being validated in the working vs not working case?&quot; How do you mean?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:03 PM</span>

                    <div class="chatlog__message " data-message-id="520253844211499008" id="message-520253844211499008">
                        <div class="chatlog__content">
                            <span class="markdown">is it the same txid being validated in both working vs not working cases?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:04 PM</span>

                    <div class="chatlog__message " data-message-id="520254119697448960" id="message-520254119697448960">
                        <div class="chatlog__content">
                            <span class="markdown">I could not make same tx to sometime work and sometimes not. Just some previous txs work and then the one that does not verify never passes</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:05 PM</span>

                    <div class="chatlog__message " data-message-id="520254568068677634" id="message-520254568068677634">
                        <div class="chatlog__content">
                            <span class="markdown">but here we have a single specific tx that is modified from when it is signed to when it is validated?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:06 PM</span>

                    <div class="chatlog__message " data-message-id="520254638377795585" id="message-520254638377795585">
                        <div class="chatlog__content">
                            <span class="markdown">Yes</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:06 PM</span>

                    <div class="chatlog__message " data-message-id="520254738411945985" id="message-520254738411945985">
                        <div class="chatlog__content">
                            <span class="markdown">the C++ memory management is a mystery to me</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520254786814083072" id="message-520254786814083072">
                        <div class="chatlog__content">
                            <span class="markdown">i cant tell what the allocated memory ptrs are</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520254857068806144" id="message-520254857068806144">
                        <div class="chatlog__content">
                            <span class="markdown">hopefully you can find the tx data and make it not molested</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:07 PM</span>

                    <div class="chatlog__message " data-message-id="520254945547780106" id="message-520254945547780106">
                        <div class="chatlog__content">
                            <span class="markdown">Well, it could be that something modified hashprevout when broadcasting that tx. There is a lot of code where tx passes before it reaches this function...</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520255641571557381" id="message-520255641571557381">
                        <div class="chatlog__content">
                            <span class="markdown">What is the first point in main.cpp (or is it main) where tx is processed after sendrawtransactin?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:13 PM</span>

                    <div class="chatlog__message " data-message-id="520256557670334488" id="message-520256557670334488">
                        <div class="chatlog__content">
                            <span class="markdown">i am pretty sure the CC validation is all done before it ever completes back up to main.cpp</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520256601949601795" id="message-520256601949601795">
                        <div class="chatlog__content">
                            <span class="markdown">but sendrawtransaction, just adds it to mempool and broadcasts it</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:14 PM</span>

                    <div class="chatlog__message " data-message-id="520256662465019908" id="message-520256662465019908">
                        <div class="chatlog__content">
                            <span class="markdown">Yep, and then it does validation I think</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:14 PM</span>

                    <div class="chatlog__message " data-message-id="520256682199220264" id="message-520256682199220264">
                        <div class="chatlog__content">
                            <span class="markdown">process message would get a new transaction and check for validity</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:14 PM</span>

                    <div class="chatlog__message " data-message-id="520256688826220580" id="message-520256688826220580">
                        <div class="chatlog__content">
                            <span class="markdown">Before relaying</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:14 PM</span>

                    <div class="chatlog__message " data-message-id="520256771537764362" id="message-520256771537764362">
                        <div class="chatlog__content">
                            <span class="markdown">or it could be part of block validation that is doing the CC validation</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520256864227688448" id="message-520256864227688448">
                        <div class="chatlog__content">
                            <span class="markdown">pretty sure it is just within the script interpreter where the cryptoconditions validation is done</span>

                        </div>



                    </div>
                    <div class="chatlog__message " data-message-id="520257047196073996" id="message-520257047196073996">
                        <div class="chatlog__content">
                            <span class="markdown">so from the time of FinalizeCCtx to where it is broadcast, must be where it is changed</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:16 PM</span>

                    <div class="chatlog__message " data-message-id="520257126485065729" id="message-520257126485065729">
                        <div class="chatlog__content">
                            <span class="markdown">Also, it could be good to check this data in the hex returned, maybe something is there malformed</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:32 PM</span>

                    <div class="chatlog__message " data-message-id="520261325415514112" id="message-520261325415514112">
                        <div class="chatlog__content">
                            <span class="markdown">It has entered to AcceptToMemoryPool already modified...</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="jl777c#5810" data-user-id="455741312273219595">jl777c</span>


                <span class="chatlog__timestamp">06-Dec-18 03:34 PM</span>

                    <div class="chatlog__message " data-message-id="520261746879889419" id="message-520261746879889419">
                        <div class="chatlog__content">
                            <span class="markdown">you verified the hex you are broadcasting is unmodified?</span>

                        </div>



                    </div>
            </div>
        </div>
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="https://cdn.discordapp.com/avatars/424224648889106444/2fcedf61e46562f71af0c11a6dedfb4f.png" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="Mihailo#5902" data-user-id="424224648889106444">Mihailo</span>


                <span class="chatlog__timestamp">06-Dec-18 03:34 PM</span>

                    <div class="chatlog__message " data-message-id="520261784385486869" id="message-520261784385486869">
                        <div class="chatlog__content">
                            <span class="markdown">Doing that now</span>

                        </div>



                    </div>
            </div>
        </div>
</div>

</body>
</html>
