==============================================================
Guild: Komodo
Channel: cc-general
Topic: Dev Docs: https://developers.komodoplatform.com | Test plan: https://docs.google.com/spreadsheets/d/1l0dWEPcrv9zE11_TD-XrX_HIYV0VLpadCJN6hvaZERc/edit#gid=211514340
https://medium.com/@jameslee777/how-to-implement-finite-state-machines-into-a-cc-8dfeadccbcad
https://github.com/dimxy/komodo/wiki/Designing-RPC-for-FSM-CC
Messages: 100
Range: before 05-Dec-19 12:00 AM
==============================================================

[22-Jul-18 04:12 PM] jl777c#5810
granted it shouldnt crash but the entire codebase is 4 days old, so not time to make it bulletproof yet

[22-Jul-18 04:21 PM] Alright#0419
I did look at the help output. The tokenid is the `name` value from `tokencreate`, yes?

[22-Jul-18 04:24 PM] jl777c#5810
id not name, as in txID

[22-Jul-18 04:29 PM] Alright#0419
Well that explains the seg fault. `tokenbalance` working fine with txid

[23-Jul-18 09:17 AM] jl777c#5810
fixed crash along with too strict error check for most of the rpc calls

[23-Jul-18 09:21 AM] jl777c#5810
if you have errors, what I need is:
a) the specific chain parameters so I can connect to it
b) the EXACT rpc call and parameters you used
c) the most important! the raw tx generated
d) clear description of why you think it is a bug. for now you need to look at the raw tx details to make sure all vins are valid, signed and all vouts are sane.
e) do not post things like "i tried X and it didnt work" as that does not help at all at this stage. These are raw transaction level things and until everything works, things wont work at the higher level.

@cipi I could use your help in validating the fill commands, it is very similar (but different) from the marketmaker order matching issues. For tokens, I actually automatically gather the required utxo for the filling side, so assuming you have the funds, the order will be filled completely.

[23-Jul-18 09:42 AM] jusoaresf#3291
would cc allow for a safe/decentralized (at least as decentralized as NNs) custodian service to hold and release funds without human intervention?

[23-Jul-18 09:50 AM] jl777c#5810
I am making a faucet demo CC contract that allows 1 coin per block to be given out

[23-Jul-18 09:50 AM] jl777c#5810
a savings contract that paid a defined amount of interest is possible as long as the coins needed to pay the interest is funded

[23-Jul-18 09:51 AM] jl777c#5810
as far as holding funds, yes, it will be very good at holding them. however the rules for releasing the funds must be 100% precisely definable via onchain events

[23-Jul-18 09:51 AM] jl777c#5810
if that is possible, then it is possible. if anywhere in there is a "and the contract magically reaches consensus on a real world event", then some magic will be needed in addition

[23-Jul-18 09:53 AM] jl777c#5810
CC contracts using arbitrary rules on CC utxo is a totally new type of contract. What applies to ETH contracts might or might not apply. So far I have been able to devise a way to implement the contract idea requests being sent, though I notice a lot of reliance on "magic" in many desired contract definitions

[23-Jul-18 09:54 AM] jl777c#5810
one solution to the "magic" would be to have an arbitration address that is controlled by a trusted arbitrator. Then a contract can use signoff from the arbitrator to attest to a specific external event

[23-Jul-18 09:56 AM] jl777c#5810
Another way is to have a specific arbitration utxo for a specific instance of a contract. The spent status of this utxo would then indicate a specific event has happened. So you would setup the arbitration utxos tied to specific events first and then setup the contract that depends on these utxos

[23-Jul-18 09:56 AM] jl777c#5810
i know how much people love utxos

[23-Jul-18 09:56 AM] jl777c#5810
now there is even more reason to become familiar with utxo as we have colored utxo, ie. a specific utxo tied to a specific external event

[23-Jul-18 09:58 AM] jl777c#5810
@SHossain I am assuming my relevant posts are being collected as CC is needing a lot of documentation

[23-Jul-18 10:10 AM] gcharang#6833
I am saving your posts about cc from this channel and other places when I see them. shossain is also doing it I think.

[23-Jul-18 10:11 AM] jl777c#5810
ok, and I am also (unusually for me) actually commenting the source code in ~/komodo/src/cc/*

[23-Jul-18 10:13 AM] jl777c#5810
we need to get it so new devs can onboard quickly to make new CC contracts. I will be making a set of reference contracts. If there is a C++ coder experience in making classes, I would appreciate a bit of help to define the CCcontract class to put all these contracts into. I am not quite clear enough on all the c++ details to feel thatI can do a proper job for this, so I am making it C based for now

[23-Jul-18 10:29 AM] SHossain#0007
yes, we are collecting them. i'll start to organise them today

{Reactions}
üëå 

[23-Jul-18 11:31 AM] jl777c#5810
pushed fix for fillbuy, now all rpc other than fillsell and swaps have been tested at least once

[23-Jul-18 12:45 PM] jl777c#5810
fillsell now has a non-zero chance of actually being sane and working

[23-Jul-18 12:48 PM] jl777c#5810
I could really use some help in finding bugs, especially with the fill commands...

[23-Jul-18 12:57 PM] SHossain#0007
@jl777c please send some ASSETS here `RANyPgfZZLhSjQB9jrzztSw66zMMYDZuxQ`

[23-Jul-18 12:59 PM] SHossain#0007
actually, now trying to mine with 2 threads

[23-Jul-18 01:00 PM] jl777c#5810
we are using alright's chain: ./komodod -ac_cc=1 -ac_name=ASSES -addressindex=1 -spentindex=1 -ac_supply=1000 -ac_reward=100000000 -pubkey=0329c28e5d0b5c49f759cfb680b08bf08fd780845b382b077a473a237841db7404 -addnode=195.201.137.5

[23-Jul-18 01:00 PM] Alright#0419
Fairly sure ASSETS is deded, I can send you some ASSES though üòÇ

[23-Jul-18 01:00 PM] Alright#0419
unstuck it?

[23-Jul-18 01:00 PM] jl777c#5810
sent some already 8b854e3e1d77b32e98dd6b8b6fc10cca87e7031a65926b6e2ace863cbd8ecf9e

[23-Jul-18 01:00 PM] jl777c#5810
update to latest on your nodes and it should confirm your bidfill

[23-Jul-18 01:01 PM] Alright#0419
üëå

[23-Jul-18 01:01 PM] SHossain#0007
thanks very much

[23-Jul-18 01:01 PM] SHossain#0007
updating

[23-Jul-18 01:01 PM] SHossain#0007
```
$ ./komodo-cli -ac_name=ASSETS getbalance
8.00000000
```

[23-Jul-18 01:01 PM] SHossain#0007
ASSETS not deaded

[23-Jul-18 01:02 PM] SHossain#0007
but, yes. i'll change to ASSES now

[23-Jul-18 01:02 PM] SHossain#0007
after the update

[23-Jul-18 01:02 PM] SHossain#0007
```
$ ./komodo-cli -ac_name=ASSETS getbalance
13.00000000
```
mining quite fast üòõ

[23-Jul-18 01:04 PM] Alright#0419
sent you some ASSES, if you sync it, you'll see bids under `tokenorders`, try to buy them

[23-Jul-18 01:05 PM] Alright#0419
Going to resyn ASSETS in a minute, I'm tired of saying ASSES

[23-Jul-18 01:50 PM] jusoaresf#3291
The kind of cc magic I dream of is related to atomic swaps
Like if I send the cc contract an X amount of coin A along with my address of coin B then, after my coin A tx gets enough confirmations, the contract will send Y amount of coin B to that address... not much hocus pocus I hope (?)

{Reactions}
üëå 

[23-Jul-18 01:57 PM] jl777c#5810
so instead of limiting things to a single chain, you want to operate on three chains?

[23-Jul-18 01:57 PM] SHossain#0007
```
end.0 blocks, reward 1.00000000 halving.0 blocks, decay.0 perc 0.0000% ac_pub=[00...]
Created (/home/hitman/.komodo/ASSES/ASSES.conf)
call komodo_args.(./komodod) NOTARY_PUBKEY.(03fe754763c176e1339a3f62ee6b9484720e17ee4646b65a119e9f6370c7004abc)
>>>>>>>>>> ASSES: p2p.53149 rpc.53150 magic.82c3e89d 2193877149 1000 coins
initialized ASSES at 1532354158
finished loading blocks ASSES
height.0 slowflag.1 possible.0 cmp.0
ProcessAssets
AssetValidate (t)
vin1 100000000, vout0 13, vout1 99999987, transfer validated 1.00000000 -> 1.00000000
AssetValidate.(t) passed
ProcessAssets
AssetValidate (t)
vin1 1000000000, vout0 100, vout1 999999900, transfer validated 10.00000000 -> 10.00000000
AssetValidate.(t) passed
ProcessAssets
AssetValidate (o)
Got 100.00000000 to origaddr.(RNv5ppQ2G7BLA2EFhFj86upZJr9tzwuuvi)
cancelbuy validated to origaddr.(RNv5ppQ2G7BLA2EFhFj86upZJr9tzwuuvi)
AssetValidate.(o) passed
ProcessAssets
AssetValidate (o)
AssetValidate.(o) failed
CC Eval EVAL_ASSETS Invalid: asset inputs != outputs spending tx 7dc1ed60260dbb2d25792de59d84151e8d6f7531b295726bf975fff2f51ea361
```

[23-Jul-18 01:58 PM] SHossain#0007
with ASSES

[23-Jul-18 01:58 PM] jl777c#5810
latest version?

[23-Jul-18 01:58 PM] SHossain#0007
yes

[23-Jul-18 01:58 PM] SHossain#0007
first start

[23-Jul-18 01:58 PM] SHossain#0007
sorry. i see another update

[23-Jul-18 01:59 PM] SHossain#0007
`Updating 75b63fa..de9e3c8`

[23-Jul-18 01:59 PM] jl777c#5810
it could be some tx on chain are invalid due to different versions along the way

[23-Jul-18 01:59 PM] SHossain#0007
compiling now

[23-Jul-18 02:00 PM] jl777c#5810
oh, that is a new bug. fixing

[23-Jul-18 02:01 PM] SHossain#0007
cool. waiting for another update üòÉ

[23-Jul-18 02:02 PM] SHossain#0007
this chain got stuck for me
```
  "blocks": 656,
  "longestchain": 1449,
```
will delete data dir and start fresh after your update

[23-Jul-18 02:05 PM] jl777c#5810
pushed fix

[23-Jul-18 02:08 PM] SHossain#0007
updating

[23-Jul-18 02:10 PM] SHossain#0007
```
end.0 blocks, reward 1.00000000 halving.0 blocks, decay.0 perc 0.0000% ac_pub=[00...]
Created (/home/hitman/.komodo/ASSES/ASSES.conf)
call komodo_args.(./komodod) NOTARY_PUBKEY.(03fe754763c176e1339a3f62ee6b9484720e17ee4646b65a119e9f6370c7004abc)
>>>>>>>>>> ASSES: p2p.53149 rpc.53150 magic.82c3e89d 2193877149 1000 coins
initialized ASSES at 1532355018
finished loading blocks ASSES
height.0 slowflag.1 possible.0 cmp.0
ProcessAssets
AssetValidate (t)
vin1 100000000, vout0 13, vout1 99999987, transfer validated 1.00000000 -> 1.00000000
AssetValidate.(t) passed
ProcessAssets
AssetValidate (t)
vin1 1000000000, vout0 100, vout1 999999900, transfer validated 10.00000000 -> 10.00000000
AssetValidate.(t) passed
ProcessAssets
AssetValidate (o)
Got 100.00000000 to origaddr.(RNv5ppQ2G7BLA2EFhFj86upZJr9tzwuuvi)
cancelbuy validated to origaddr.(RNv5ppQ2G7BLA2EFhFj86upZJr9tzwuuvi)
AssetValidate.(o) passed
ProcessAssets
AssetValidate (o)
AssetValidate.(o) failed
CC Eval EVAL_ASSETS Invalid: asset inputs != outputs spending tx 7dc1ed60260dbb2d25792de59d84151e8d6f7531b295726bf975fff2f51ea361```

[23-Jul-18 02:11 PM] SHossain#0007
latest output

[23-Jul-18 02:11 PM] jl777c#5810
ok I will resync and try to reproduce

{Reactions}
üëç 

[23-Jul-18 02:13 PM] jl777c#5810
reproduced. fixing

[23-Jul-18 02:13 PM] SHossain#0007
nice. sync stopped for me at the same block

[23-Jul-18 02:14 PM] SHossain#0007
656

[23-Jul-18 02:15 PM] jl777c#5810
yes bug in new validation code, fixing

[23-Jul-18 02:20 PM] jusoaresf#3291
3? I thought it was 2 ... üò¶

[23-Jul-18 02:21 PM] jl777c#5810
cross chain from one to another and the chain with CC

[23-Jul-18 02:21 PM] jl777c#5810
it is possible but need to get more infrastructure in place. let us start with the simpler things

[23-Jul-18 02:22 PM] jl777c#5810
@SHossain pushed fix

[23-Jul-18 02:22 PM] jl777c#5810
oh but stuck at 656 investigating

[23-Jul-18 02:22 PM] SHossain#0007
ok. waiting for next fix

[23-Jul-18 02:26 PM] jl777c#5810
actually i think the other node is just not responding

[23-Jul-18 02:26 PM] jl777c#5810
plz make a new test chain and test things not contaminated by older versions

[23-Jul-18 02:28 PM] SHossain#0007
ok. let me prepare a vps as seednode first

[23-Jul-18 02:44 PM] Mylo#8306
jl777 or dev branch?

[23-Jul-18 02:46 PM] jl777c#5810
only jl777 for now

[23-Jul-18 02:55 PM] SHossain#0007
fresh clone build failed in my VPS
```
cc/CCcustom.cpp: In function ‚Äòbool IsAssetsInput(const CScript&)‚Äô:
cc/CCcustom.cpp:55:57: error: cannot convert ‚ÄòIsAssetsInput(const CScript&)::<lambda(CC*, CCVisitor)>‚Äô to ‚Äòint (*)(CC*, CCVisitor)‚Äô in initialization
     CCVisitor visitor = {findEval, (uint8_t*)"", 0, NULL};
                                                         ^
cc/CCcustom.cpp: In function ‚Äòbool IsFaucetInput(const CScript&)‚Äô:
cc/CCcustom.cpp:72:57: error: cannot convert ‚ÄòIsFaucetInput(const CScript&)::<lambda(CC*, CCVisitor)>‚Äô to ‚Äòint (*)(CC*, CCVisitor)‚Äô in initialization
     CCVisitor visitor = {findEval, (uint8_t*)"", 0, NULL};
                                                         ^
Makefile:2886: recipe for target 'cc/libbitcoin_server_a-CCcustom.o' failed
make[2]: *** [cc/libbitcoin_server_a-CCcustom.o] Error 1
make[2]: *** Waiting for unfinished jobs....
mv -f cc/.deps/libbitcoin_server_a-CCtx.Tpo cc/.deps/libbitcoin_server_a-CCtx.Po
mv -f cc/.deps/libbitcoin_server_a-CCutils.Tpo cc/.deps/libbitcoin_server_a-CCutils.Po
mv -f cc/.deps/libbitcoin_server_a-assets.Tpo cc/.deps/libbitcoin_server_a-assets.Po
make[2]: Leaving directory '/home/lpx/komodo/src'
Makefile:4387: recipe for target 'all-recursive' failed
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory '/home/lpx/komodo/src'
Makefile:659: recipe for target 'all-recursive' failed
make: *** [all-recursive] Error 1
```

[23-Jul-18 02:56 PM] blackjok3r#3181
I had that error, ubuntu 16.04 (GCC version 5) fixed it

[23-Jul-18 02:56 PM] blackjok3r#3181
GCC 6 would not compile nor GCC 7

[23-Jul-18 03:00 PM] Mylo#8306
and to give you an example of this 3rd chain stuff, i sent libscott this message a week or two ago when prodding for info:
```
Yes. In steps of "can we achieve it with CC"

Address on chain A to automatically accrue funds from chain B
At a block height (divisible by 1000 for example), chain A uses a cc to exchange chain B in their wallet for chain C
The chain C only has a finite amount available for exchange with chain B every 1000 blocks.
For instance, every new KMD address receives PIONEERS. Every 1000 blocks, if the wallet hasn't got any MEETUPS or the PIONEERS address hasn't been used to swap for MEETUPS in the past, some PIONEERS coins are exchanged for MEETUPS.

As a side note, the komodopioneers notary node offers meetup subsidies. So in this example, in order to get a komodopioneers meetup subsidy (up to $300), you need to exchange 100k MEETUPS, by collecting MEETUPS from people. Because MEETUPS are available everywhere, it's a means/incentive for people holding the event to collect MEETUPS from people (at the event or just online or through forum, or computer generated script)
```
and the awesome reply was
```
Yea... lets imagine this is possible <------this!----
The thing is all the transactions need to be triggered manually
```

[23-Jul-18 03:02 PM] Mylo#8306
basically chain A -> get token A -> exchange for token C at certain times in blockchain life (height)

[23-Jul-18 03:03 PM] SHossain#0007
i had gcc v7.2

{Reactions}
üëç 

[23-Jul-18 03:04 PM] Mylo#8306
oooh sorry for interrupting

[23-Jul-18 03:05 PM] blackjok3r#3181
Only works on GCC 5 for me.. tested on 3 systems today.

[23-Jul-18 03:07 PM] SHossain#0007
hmmm...ok. i'll roll back to older version

[23-Jul-18 03:09 PM] jl777c#5810
@libscott can you fix the old gcc dependence described above?

[23-Jul-18 03:15 PM] cipi#4502
you can have multiple gcc-versions installed at the same time and switch between them as needed

[23-Jul-18 03:15 PM] cipi#4502
```sudo apt-get install gcc-5 g++-5 gcc-6 g++-6 gcc-7 g++-7
sudo update-alternatives --remove-all gcc
sudo update-alternatives --remove-all g++
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-6 60 --slave /usr/bin/g++ g++ /usr/bin/g++-6
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 40 --slave /usr/bin/g++ g++ /usr/bin/g++-5
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 50 --slave /usr/bin/g++ g++ /usr/bin/g++-7

# switch gcc with
sudo update-alternatives --config gcc```

[23-Jul-18 03:16 PM] cipi#4502
@jl777c how can i help with the fill-testing? I have to admit, i haven't used cc till now

[23-Jul-18 03:17 PM] jl777c#5810
you just need to use the token rpc calls, it will do all the CC for you

[23-Jul-18 03:17 PM] jl777c#5810
tokenaddress [pubkey]
tokenask numtokens tokenid price
tokenbalance tokenid [pubkey]
tokenbid numtokens tokenid price
tokencancelask tokenid asktxid
tokencancelbid tokenid bidtxid
tokencreate name supply description
tokenfillask tokenid asktxid fillamount
tokenfillbid tokenid bidtxid fillamount
tokenfillswap tokenid otherid asktxid fillamount
tokenorders [tokenid]
tokenswap numtokens tokenid otherid price
tokentransfer tokenid destpubkey amount

[23-Jul-18 03:17 PM] jl777c#5810
tokenbid is filled with tokenfillbid

[23-Jul-18 03:17 PM] jl777c#5810
tokenask is filled with tokenfillask

[23-Jul-18 03:18 PM] jl777c#5810
once those are working, we can worry about tokenswap

[23-Jul-18 03:23 PM] jl777c#5810
just ask if any questions, I realize not any docs yet

[23-Jul-18 03:24 PM] Alright#0419
@SHossain did you start a fresh chain?

[23-Jul-18 03:24 PM] Alright#0419
my nodes kept mining on ASSES

[23-Jul-18 03:25 PM] Alright#0419
can you give me params for new chain?

[23-Jul-18 03:27 PM] jl777c#5810
pushed fix for things not syncing to the existing chain

[23-Jul-18 03:27 PM] jl777c#5810
it was quite interesting

[23-Jul-18 03:28 PM] jl777c#5810
the problem was that the transactions were not in the mempool

